# Kcode 법령/법위반 시스템 명세서 (v4.0.0)

## 1. 개요: 왜 법령/법위반인가

### Kcode의 시스템은 프로그래밍의 'Design by Contract(DbC)' 개념을 한국어 법률 용어로 표현한 런타임 계약 검증 시스템입니다. 함수 단위로 실행 전후의 조건을 강제하며, 위반 시 제재를 자동 적용합니다.  

-----


## 개념 요약


    • 법령: 사전조건 (Precondition). 법이 적용되려면 ~이어야 함.

    • 법위반: 사후조건 (Postcondition). 실행 후 ~이 성립해야 함.

    • 복원지점: 원상복구 기준 시점 지정 (Checkpoint).


-----


## 2. 문법 및 범위

### 기본 형식 

    • 법령 [범위], [조건], [제재]

    • 법위반 [범위], [조건], [제재]

    • (함수 선언 안이나 밖 어디든 작성 가능)


### 범위 종류

    • 함수명: 지정한 함수 하나에만 적용 (예: 법령 나누기, 나 != 0, 중단)

    • 전역: 모든 함수/정의에 자동 적용 (예: 법령 전역, 입력 != 없음, 보고)

    • 객체명: 해당 객체의 모든 메서드에 적용 (예: 법령 계좌, 잔액 >= 0, 회귀)

    • 정의명: 지정한 정의(void함수) 하나에 적용 (예: 법위반 출력처리, 결과 != 없음, 경고)


-----


## 3. 제재 및 실행 흐름

### 제재 종류 및 동작  

    • 경고: 메시지 출력 후 실행 계속 (즉시 적용)

    • 보고: 로그 기록 후 실행 계속 (즉시 적용)

    • 중단: 오류 발생 후 실패시(catch) 블록으로 전달 (즉시 중단)

    • 회귀: 복원지점으로 상태 되돌림 후 중단 (즉시 중단)

    • 대체값: 지정값을 반환하고 함수 종료 (즉시 종료)

    • 대체 함수명: 지정한 대체 함수를 대신 실행 (즉시 대체실행)


### 복원지점(회귀) 안내  

    • 복원지점 [이름] 형식으로 현재 상태를 스냅샷 저장합니다.

    • 전역 환경의 변수 값만 복원하며, 파일 I/O나 네트워크 등 물리적 요소는 제외됩니다.


-----

## 4. 코드 예시


### 함수 내외 선언 예시

```

    
    법령 나누기, 나 != 0, 중단

    법위반 나누기, 반환값 != 없음, 경고

    함수 나누기(정수 가, 정수 나):

    반환 가 / 나


```

### 계좌 출금 및 회귀 예시

```

    복원지점 초기상태

    법령 계좌, 잔액 >= 0, 회귀 초기상태

    법위반 계좌, 잔액 >= 0, 중단

    객체 계좌:

        정수 잔액 = 0

        정의 출금(자신, 정수 금액):

            자신.잔액 -= 금액

```

-----

## 5. 구현 및 가속기 계획


### 변경 파일 (v4.0.0 기준)  

    • klexer: 법령, 법위반 등 주요 토큰 추가

    • kparser: NODE_CONTRACT, NODE_CHECKPOINT 노드 추가

    • kinterp: ContractRegistry 및 스냅샷 관리 구현

    • kcodegen: C assert 매크로 변환 적용



### 가속기 블록 (B방식)  

    • CuPy/PyTorch 스크립트로 위임 실행하며, 미설치 시 NumPy로 자동 폴백됩니다.

    • 예시: 가속기: 행렬곱(A, B) 가속기끝


-----

|       | Kcode 법령/법위반 시스템 명세                                                        |
|-------|-------------------------------------------------|

|License | zerojat7 

|-------|-------------------------------------------------|

|Github  | zerojat7-ui.github.oi/KCODE

|-------|-------------------------------------------------|

|version|1.0.0

-----